<html>
  <head>
    <title>OAuth Authorization Flow</title>
    <meta charset="UTF-8" />
    <script src="/dist/lib.umd.min.js"></script>
  </head>

  <body>
    <div id="app">Loading...</div>

    <script type="text/javascript">
      const client = allthings.restClient({
        oauthUrl: 'https://accounts.dev.allthings.me',
        apiUrl: 'https://api.dev.allthings.me',
        clientId: OAUTH_CLIENT,
      })

      window.addEventListener('load', async () => {
        // e.g.
        // http://localhost:3333/test/fixtures/implicit-flow?clientId=foobarIdHere
        // const OAUTH_CLIENT = window.location.search.split('=')[1]

        const user = await client.getCurrentUser()

        document.getElementById('app').innerHTML = `<div>Hi there, ${
          user.username
        } (${user.email})</div>`
      })

      const checkMe = async () => {
        const user = await client.getCurrentUser()

        console.log(user)
      }
    </script>
    <button onClick="checkMe()">click me</button>
  </body>
</html>
